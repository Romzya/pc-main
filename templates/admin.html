<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель</title>
</head>
<body>
    <h1>Админ-панель</h1>
    <div>
        <a href="{{ url_for('index') }}">На главную</a> | 
        <a href="{{ url_for('admin_panel') }}">Все сборки</a> |
        <a href="{{ url_for('admin_users') }}">Пользователи</a> |
        <a href="{{ url_for('manage_components_page') }}">Управление комплектующими</a> |
        <a href="{{ url_for('logout') }}">Выйти</a>
    </div>
    
    <div>
        <h2>Статистика:</h2>
        <p><strong>Всего пользователей:</strong> {{ stats.total_users }}</p>
        <p><strong>Всего сборок:</strong> {{ stats.total_gadjets }}</p>
        <p><strong>Общая стоимость всех сборок:</strong> {{ "%.2f"|format(stats.total_price) if stats.total_price else 0 }} руб.</p>
    </div>
    
    <h2>Все сборки пользователей:</h2>
    
    {% if all_gadjets %}
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Пользователь</th>
                <th>Номер телефона</th>
                <th>Процессор</th>
                <th>Материнская плата</th>
                <th>Система охлаждения</th>
                <th>ОЗУ</th>
                <th>Видеокарта</th>
                <th>БП</th>
                <th>Корпус</th>
                <th>Стоимость</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for gadget in all_gadjets %}
            <tr>
                <td>{{ gadget.id }}</td>
                <td>{{ gadget.username }}</td>
                <td>{{ gadget.TP }}</td>
                <td>{{ gadget.Proc }}</td>
                <td>{{ gadget.MPlata }}</td>
                <td>{{ gadget.CW }}</td>
                <td>{{ gadget.RAM }}</td>
                <td>{{ gadget.VideoCard }}</td>
                <td>{{ gadget.BP }}</td>
                <td>{{ gadget.Corpus }}</td>
                <td><strong>{{ "%.2f"|format(gadget.total_price) if gadget.total_price else 0 }} руб.</strong></td>
                <td>
                    {% set build_status = get_build_status(gadget.id) %}
                    {% if build_status.needs_approval == 1 %}
                    ⚠️ Нужно согласование
                    {% else %}
                    ✅ Активна
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('build_chat', build_id=gadget.id) }}">Чат</a>
                    <a href="{{ url_for('edit_build', build_id=gadget.id) }}">Редакт.</a>
                    <a href="{{ url_for('delete_password', password_id=gadget.id) }}" 
                       onclick="return confirm('Удалить сборку #{{ gadget.id }} пользователя {{ gadget.username }}?')">Удалить</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Нет сборок</p>
    {% endif %}
</body>
</html>